<!DOCTYPE html>
<html>
<head>
<title>Vizit</title>
<style>
#map {
  height: 100%;
}
html,
body {
  height: 100%;
  margin: 0;
  padding: 0;
}
</style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.1/papaparse.min.js"></script>
<script src='https://cdnjs.cloudflare.com/ajax/libs/plotly.js/2.8.0/plotly.min.js'></script>
<script src="https://polyfill.io/v3/polyfill.min.js?features=default"></script>
<script>
function initMap() {
  // Create the map.
  farmMap = new google.maps.Map(document.getElementById("map"), {
    zoom: 4,
    center: { lat: 37.09, lng: -95.712 },
    mapTypeId: "terrain",
  });
}
</script>
</head>
<body>
<input type="file" id="files" name="files[]" multiple />
<div id="map"></div>
<script>
function farmCircleListener(){
  alert(this.customText);
}
function handleFileSelect(evt) {
  var file = evt.target.files[0]; // File
  Papa.parse(file, {
    header: false,
    complete: function(results) {
      header = results.data[0];
      var colidx = {};
      for (var i = 0; i < header.length; i++){
        colidx[header[i]] = i;
      }
      arrayLength  = results.data.length;
      //Add the circles to map
      for (var i = 1; i < arrayLength - 1; i++) {
        var thisLat = parseFloat(results.data[i][colidx['latitude']]);
        var thisLng = parseFloat(results.data[i][colidx['longitude']]);
        var thisCap = parseFloat(results.data[i][colidx['cap_sc(MW)']]);
        var thisMetric = parseFloat(results.data[i][colidx['reduced_cost($_per_kW)']]);
        var thisDens = results.data[i][colidx['type']] == 'offshore' ? .18816 : 0.33333; //offshore is .18816 km2 per MW. Onshore is 0.33333 km2 per MW
        farmCircle = new google.maps.Circle({
          strokeWeight: 0,
          fillColor: "#FF0000",
          fillOpacity: -1/2000*thisMetric + 1, //y=mx + b, where y is opacity, from 0 to 1.
          map:farmMap,
          center: {lat: thisLat, lng: thisLng},
          radius: Math.sqrt(thisCap*thisDens/Math.PI)*1000,
          customText: 'Reduced Cost: ' + thisMetric + ' $/kW',
        });
        google.maps.event.addListener(farmCircle, 'click', farmCircleListener);
        // farmCircle.addListener("click", () => {
        //   var x = 'hi';
        // });
      }
    }
  });
}
document.getElementById('files').addEventListener('change', handleFileSelect, false);
</script>
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAIWJ6Gd3cnTqmE3_rYiDZmCwcFVurpjgw&callback=initMap&v=weekly" async></script>
</body>
</html>